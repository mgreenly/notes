# 2019-10-13

This is my first experiment with GKE.  The goal here is just
to get something up and running that can be improved on later.

## GKE

```
# TODO: set the organization and create a project
$> gcloud config set project logic-refinery-com
```

## Create cluster

First create the cluster

```
gcloud beta container \
  clusters create "production" \
    --zone "us-central1-a" \
    --cluster-version "1.13.10-gke.0" \
    --machine-type "n1-standard-1" \
    --disk-type "pd-standard" \
    --disk-size "100" \
    --num-nodes "2" \
    --enable-ip-alias 
    --no-enable-basic-auth \
    --no-issue-client-certificate
    --no-enable-autoupgrade \
    --enable-autorepair
```

## Get Cluster Credentials

```
gcloud container clusters get-credentials production
```

## Deploy the apps

```
kubectl apply -f www.yaml
kubectl apply -f app.yaml
```

## Deploy Proxy

First edit the proxy config so that it has the cluster ips of www and app then deploy it


```
kubectl apply -f proxy.yaml
```


## Firewall

Create a firewall rule that will allow the loadbalancer
to send traffic to the cluster

```
gcloud compute \
  --project=logic-refinery-com \
  firewall-rules create logic-refinery-ingress \
  --direction=INGRESS \
  --priority=1000 \
  --network=default \
  --action=ALLOW \
  --rules=tcp:30080 \
  --source-ranges=0.0.0.0/0 \
  --target-tags=gke-production-c0f99aed-node
```


create load balancer

```
#TODO: creat the load balancer
```
